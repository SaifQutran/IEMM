<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IEMM - ุงูููุงุชูุฑ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="../views/css/styles.css">
  <link rel="stylesheet" href="../views/css/chat.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="../views/js/script.js" defer></script>
  <script src="../views/js/stores/chat.js" defer></script>
</head>
<body>
  <!-- Header Section -->
  <header>
    <div class="container navbar">
      <h1>IEMM</h1>
      <nav>
        <a href="shop-dashboard.html" id="dashboard-link">๐ ููุญุฉ ุงูุชุญูู</a>
        <a href="products-management.html" id="products-link">๐๏ธ ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</a>
        <a href="inventory.html" id="inventory-link">๐ฆ ุงููุฎุฒูู</a>

        <a href="employees.html" id="staff-link">๐ฅ ุฅุฏุงุฑุฉ ุงูุนุงูููู</a>
        <a href="bills-stores.html" id="bills-link" class="active">๐ฐ ุงูููุงุชูุฑ</a>
      </nav>
      <div style="display: flex; align-items: center; gap: 12px;">
        <button class="btn-dark" onclick="document.body.classList.toggle('dark')">ุงููุถุน ุงููููู</button>
        <button id="chat-toggle" class="chat-toggle-btn" title="ุงูุฏุฑุฏุดุฉ ูุน ูุฏูุฑ ุงูููู">
          <i class="fas fa-comments"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- ูุงูุฐุฉ ุงูุฏุฑุฏุดุฉ ุงูุฌุงูุจูุฉ -->
  <div id="chat-panel" class="chat-panel">
    <div class="chat-header">
      <div class="mall-logo-container">
        <img id="mall-logo" alt="ุดุนุงุฑ ุงูููู" class="mall-logo">
        <h3>ุงูุฏุฑุฏุดุฉ ูุน ูุฏูุฑ ุงูููู</h3>
      </div>
      <button id="chat-close" class="chat-close-btn">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="messages-container" class="messages-container">
      <!-- ุณูุชู ุฅูุดุงุก ุงูุฑุณุงุฆู ุนุจุฑ JavaScript -->
    </div>
    <form id="message-form" class="message-form">
      <textarea id="message-input" class="message-input" placeholder="ุงูุชุจ ุฑุณุงูุชู ููุง..." rows="1"></textarea>
      <button type="submit" class="send-message-btn">
        <i class="fas fa-paper-plane"></i>
      </button>
    </form>
  </div>

  <!-- Main Content -->
  <div class="main">
    <!-- Bills Section -->
    <div class="section active" id="bills-section">
      <div class="section-header">
        <h2 class="section-title">๐ฐ ุงููุจูุนุงุช ูุงูููุงุชูุฑ</h2>
      </div>

      <div class="bills-grid">
        <!-- ุจุทุงูุฉ ุณุฌู ุงููุจูุนุงุช -->
        <div class="table card">
          <div class="table-header">
            <h3>ุณุฌู ุงููุจูุนุงุช</h3>
            <div class="table-actions">
              <div class="quick-sale">
                <div class="quick-sale-header">
                  <button class="btn-green" onclick="openNewSaleForm()">ุจุฏุก ุนูููุฉ ุจูุน ุฌุฏูุฏุฉ</button>
                </div>
                <div id="new-sale-form" class="new-sale-form" style="display: none;">
                  <div class="form-header">
                    <div class="sale-info">
                      <div class="info-row">
                        <span>ุฑูู ุงูุนูููุฉ:</span>
                        <span id="sale-number">#12345</span>
                      </div>
                      <div class="info-row">
                        <span>ุงูุชุงุฑูุฎ:</span>
                        <span id="sale-date"></span>
                      </div>
                    </div>
                    <button class="btn-icon" onclick="closeNewSaleForm()">ร</button>
                  </div>
                  <div class="form-content">
                    <div class="sale-grid">
                      <div class="product-input-section">
                        <div class="input-group">
                          <label>ุงูุจุงุฑููุฏ</label>
                          <input type="text" id="barcode-input" placeholder="ูุณุญ ุงูุจุงุฑููุฏ..." autocomplete="off">
                        </div>
                        <div class="input-group">
                          <label>ุงุณู ุงูููุชุฌ</label>
                          <input type="text" id="product-name" placeholder="ุงุณู ุงูููุชุฌ..." readonly>
                        </div>
                        <div class="input-group">
                          <label>ุงููููุฉ</label>
                          <input type="number" id="product-quantity" min="1" value="1">
                        </div>
                        <button class="btn-green" onclick="addProductToSale()">ุฅุถุงูุฉ</button>
                      </div>

                      <div class="invoice-section">
                        <div class="invoice-table">
                          <table>
                            <thead>
                              <tr>
                                <th>ุงุณู ุงูููุชุฌ</th>
                                <th>ุงูุจุงุฑููุฏ</th>
                                <th>ุงูุณุนุฑ</th>
                                <th>ุงููููุฉ</th>
                                <th>ุงูุฅุฌูุงูู</th>
                                <th>ุญุฐู</th>
                              </tr>
                            </thead>
                            <tbody id="selected-products-list"></tbody>
                          </table>
                        </div>

                        <div class="invoice-summary card">
                          <h4>ููุฎุต ุงููุงุชูุฑุฉ</h4>
                          <div class="summary-grid">
                            <div class="summary-item">
                              <span class="summary-label"><i class="fas fa-box"></i> ุนุฏุฏ ุงูููุชุฌุงุช:</span>
                              <span class="summary-value" id="products-count">0</span>
                            </div>
                            <div class="summary-item">
                              <span class="summary-label"><i class="fas fa-calculator"></i> ุฅุฌูุงูู ุงูููุชุฌุงุช:</span>
                              <span class="summary-value" id="subtotal">0.00 ุฑูุงู</span>
                            </div>
                            <div class="summary-item discount">
                              <span class="summary-label"><i class="fas fa-percent"></i> ุงูุฎุตู:</span>
                              <div class="discount-input">
                                <input type="number" id="discount" value="0" min="0" onchange="updateBillSummary()" class="form-control">
                                <span class="currency">ุฑูุงู</span>
                              </div>
                            </div>
                            <div class="summary-item">
                              <span class="summary-label"><i class="fas fa-file-invoice-dollar"></i> ุงูุถุฑูุจุฉ (15%):</span>
                              <span class="summary-value" id="tax">0.00 ุฑูุงู</span>
                            </div>
                            <div class="summary-item total">
                              <span class="summary-label"><i class="fas fa-money-bill-wave"></i> ุงูุฅุฌูุงูู ุงูููุงุฆู:</span>
                              <span class="summary-value highlight" id="total">0.00 ุฑูุงู</span>
                            </div>
                          </div>
                        </div>

                        <div class="payment-section">
                          <div class="payment-method">
                            <label>ุทุฑููุฉ ุงูุฏูุน:</label>
                            <select id="payment-method">
                              <option value="cash">ููุฏู</option>
                              <option value="card">ุจุทุงูุฉ</option>
                              <option value="transfer">ุชุญููู</option>
                            </select>
                          </div>
                          <div class="form-actions">
                            <button class="btn-secondary" onclick="closeNewSaleForm()">ุฅูุบุงุก</button>
                            <button class="btn-green" onclick="completeSale()">ุชุฃููุฏ ุงูุจูุน</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>ุฑูู ุงูุนูููุฉ</th>
                  <th>ุงูุชุงุฑูุฎ</th>
                  <th>ุงูููุธู</th>
                  <th>ุนุฏุฏ ุงูููุชุฌุงุช</th>
                  <th>ุทุฑููุฉ ุงูุฏูุน</th>
                  <th>ุงููุจูุบ ุงูุฅุฌูุงูู</th>
                  <th>ุงูุญุงูุฉ</th>
                  <th>ุงูุฅุฌุฑุงุกุงุช</th>
                </tr>
              </thead>
              <tbody id="sales-table-body">
                <!-- ุณูุชู ููุคูุง ุจูุงุณุทุฉ JavaScript -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- ุจุทุงูุฉ ุงูููุงุชูุฑ ุงููุงุฑุฏุฉ -->
        <div class="table card">
          <div class="table-header">
            <h3>ุงูููุงุชูุฑ ุงููุงุฑุฏุฉ ูู ุงูููู</h3>
            <div class="table-actions">
              <div class="filter-controls">
                <select id="bill-status-filter">
                  <option value="all">ุฌููุน ุงูุญุงูุงุช</option>
                  <option value="pending">ูุนููุฉ</option>
                  <option value="paid">ูุฏููุนุฉ</option>
                  <option value="overdue">ูุชุฃุฎุฑุฉ</option>
                </select>
              </div>
            </div>
          </div>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>ุฑูู ุงููุงุชูุฑุฉ</th>
                  <th>ุงูุชุงุฑูุฎ</th>
                  <th>ููุน ุงููุงุชูุฑุฉ</th>
                  <th>ุงููุจูุบ</th>
                  <th>ุชุงุฑูุฎ ุงูุงุณุชุญูุงู</th>
                  <th>ุงูุญุงูุฉ</th>
                  <th>ุงูุฅุฌุฑุงุกุงุช</th>
                </tr>
              </thead>
              <tbody id="incoming-bills-table-body">
                <!-- ุณูุชู ููุคูุง ุจูุงุณุทุฉ JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CSS ูุชูุณูู ูุณู ุงูููุงุชูุฑ -->
  <style>
    .bills-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
      gap: 24px;
      margin-top: 24px;
    }

    .filter-controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .filter-controls select {
      padding: 8px 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 0.9rem;
      background: #fff;
      color: #1e293b;
    }

    .filter-controls select:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
      outline: none;
    }

    /* Dark Mode Styles */
    body.dark .filter-controls select {
      background: var(--dark-chart);
      color: var(--dark-text);
      border-color: #334155;
    }

    .status-badge {
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .status-badge.pending {
      background: rgba(245, 158, 11, 0.1);
      color: #f59e0b;
    }

    .status-badge.paid {
      background: rgba(34, 197, 94, 0.1);
      color: #22c55e;
    }

    .status-badge.overdue {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }

    body.dark .status-badge.pending {
      background: rgba(245, 158, 11, 0.2);
      color: #fbbf24;
    }

    body.dark .status-badge.paid {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
    }

    body.dark .status-badge.overdue {
      background: rgba(239, 68, 68, 0.2);
      color: #f87171;
    }

    /* ุชูุณููุงุช ูููุฐุฌ ุงููุจูุนุงุช */
    .new-sale-form {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      margin-top: 20px;
      overflow: hidden;
      max-width: 100%;
    }

    .form-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
    }

    .sale-info {
      display: flex;
      gap: 16px;
    }

    .info-row {
      display: flex;
      gap: 8px;
      align-items: center;
      padding: 6px 12px;
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .form-content {
      padding: 16px;
    }

    .sale-grid {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 16px;
      min-height: 400px;
    }

    .product-input-section {
      background: #f8fafc;
      padding: 16px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      height: fit-content;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .input-group label {
      font-size: 0.85rem;
      color: #64748b;
      font-weight: 500;
    }

    .input-group input {
      padding: 8px 12px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      font-size: 0.9rem;
      height: 36px;
    }

    .invoice-section {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .invoice-table {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      overflow: hidden;
      flex: 1;
    }

    .invoice-table table {
      width: 100%;
      border-collapse: collapse;
    }

    .invoice-table th,
    .invoice-table td {
      padding: 8px 12px;
      text-align: right;
      border-bottom: 1px solid #e2e8f0;
      font-size: 0.9rem;
    }

    .invoice-table th {
      background: #f8fafc;
      font-weight: 600;
      color: #1e293b;
      white-space: nowrap;
    }

    .invoice-table tbody tr:hover {
      background: #f8fafc;
    }

    .invoice-summary {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 12px;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }

    .summary-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding: 8px;
      background: #f8fafc;
      border-radius: 6px;
    }

    .summary-item.total {
      grid-column: 1 / -1;
      background: #1e293b;
      color: #fff;
      padding: 10px;
    }

    .summary-label {
      font-size: 0.8rem;
      color: #64748b;
      font-weight: 500;
    }

    .summary-value {
      font-size: 0.95rem;
      font-weight: 600;
      color: #1e293b;
    }

    .summary-item.total .summary-label,
    .summary-item.total .summary-value {
      color: #fff;
    }

    .discount-input {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .discount-input input {
      width: 80px;
      padding: 6px 8px;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      font-size: 0.9rem;
      height: 32px;
    }

    .currency {
      color: #64748b;
      font-size: 0.85rem;
    }

    .payment-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8fafc;
      padding: 10px 12px;
      border-radius: 8px;
      margin-top: 8px;
    }

    .payment-method {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .payment-method label {
      font-weight: 500;
      color: #1e293b;
      font-size: 0.9rem;
    }

    .payment-method select {
      padding: 6px 10px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      font-size: 0.9rem;
      min-width: 120px;
      height: 36px;
    }

    .form-actions {
      display: flex;
      gap: 8px;
    }

    .form-actions button {
      padding: 8px 16px;
      font-size: 0.9rem;
      height: 36px;
    }

    /* Dark Mode Styles */
    body.dark .new-sale-form {
      background: var(--dark-card);
    }

    body.dark .form-header {
      background: var(--dark-chart);
      border-color: #334155;
    }

    body.dark .info-row {
      background: var(--dark-card);
    }

    body.dark .product-input-section {
      background: var(--dark-chart);
    }

    body.dark .input-group input {
      background: var(--dark-card);
      color: var(--dark-text);
      border-color: #334155;
    }

    body.dark .invoice-table {
      background: var(--dark-card);
      border-color: #334155;
    }

    body.dark .invoice-table th {
      background: var(--dark-chart);
      color: var(--dark-text);
    }

    body.dark .invoice-table td {
      border-color: #334155;
      color: var(--dark-text);
    }

    body.dark .invoice-table tbody tr:hover {
      background: var(--dark-chart);
    }

    body.dark .invoice-summary {
      background: var(--dark-card);
      border-color: #334155;
    }

    body.dark .summary-item {
      background: var(--dark-chart);
    }

    body.dark .summary-label {
      color: #94a3b8;
    }

    body.dark .summary-value {
      color: var(--dark-text);
    }

    body.dark .summary-item.total {
      background: #1e293b;
    }

    body.dark .discount-input input {
      background: var(--dark-card);
      color: var(--dark-text);
      border-color: #334155;
    }

    body.dark .currency {
      color: #94a3b8;
    }

    body.dark .payment-section {
      background: var(--dark-chart);
    }

    body.dark .payment-method label {
      color: var(--dark-text);
    }

    body.dark .payment-method select {
      background: var(--dark-card);
      color: var(--dark-text);
      border-color: #334155;
    }
  </style>

  <!-- Add JavaScript functionality for the bills section -->
  <script>
    // ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ ููููุงุชูุฑ ุงููุงุฑุฏุฉ
    document.addEventListener('DOMContentLoaded', function() {
      const incomingBills = [
        {
          id: 'BILL-001',
          date: '2024-03',
          type: 'ุฅูุฌุงุฑ ุงููุญู',
          amount: 5000,
          dueDate: '2024-03-30',
          status: 'pending'
        },
        {
          id: 'BILL-002',
          date: '2024-03',
          type: 'ููุฑุจุงุก',
          amount: 800,
          dueDate: '2024-03',
          status: 'paid'
        },
        {
          id: 'BILL-003',
          date: '2024-03-01',
          type: ' ูุงุก ',
          amount: 1200,
          dueDate: '2024-03-15',
          status: 'overdue'
        }
      ];

      const tbody = document.getElementById('incoming-bills-table-body');
      incomingBills.forEach(bill => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${bill.id}</td>
          <td>${bill.date}</td>
          <td>${bill.type}</td>
          <td>${bill.amount} ุฑูุงู</td>
          <td>${bill.dueDate}</td>
          <td><span class="status-badge ${bill.status}">${getStatusText(bill.status)}</span></td>
          <td>
            <button class="btn-icon" onclick="viewBill('${bill.id}')">๐๏ธ</button>
            <button class="btn-icon" onclick="payBill('${bill.id}')">๐ฐ</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    });

    function getStatusText(status) {
      const statusMap = {
        pending: 'ูุนููุฉ',
        paid: 'ูุฏููุนุฉ',
        overdue: 'ูุชุฃุฎุฑุฉ'
      };
      return statusMap[status] || status;
    }

    function viewBill(billId) {
      // ุนุฑุถ ุชูุงุตูู ุงููุงุชูุฑุฉ
      alert(`ุนุฑุถ ุชูุงุตูู ุงููุงุชูุฑุฉ ${billId}`);
    }

    function payBill(billId) {
      // ูุนุงูุฌุฉ ุฏูุน ุงููุงุชูุฑุฉ
      if (confirm('ูู ุชุฑูุฏ ุงููุชุงุจุนุฉ ูุฏูุน ูุฐู ุงููุงุชูุฑุฉุ')) {
        alert(`ุชู ูุชุญ ุตูุญุฉ ุงูุฏูุน ูููุงุชูุฑุฉ ${billId}`);
      }
    }

    // ุชุตููุฉ ุงูููุงุชูุฑ ุญุณุจ ุงูุญุงูุฉ
    document.getElementById('bill-status-filter').addEventListener('change', function(e) {
      const status = e.target.value;
      const rows = document.querySelectorAll('#incoming-bills-table-body tr');
      
      rows.forEach(row => {
        if (status === 'all' || row.querySelector('.status-badge').classList.contains(status)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    });

    // ูุธุงุฆู ุงููุจูุนุงุช
    function openNewSaleForm() {
      const form = document.getElementById('new-sale-form');
      form.style.display = 'block';
      
      // ุชุญุฏูุซ ุงูุชุงุฑูุฎ ูุงูููุช
      const now = new Date();
      document.getElementById('sale-date').textContent = now.toLocaleString('ar-SA');
      
      // ุชุญุฏูุซ ุฑูู ุงูุนูููุฉ
      const saleNumber = Math.floor(Math.random() * 100000);
      document.getElementById('sale-number').textContent = `#${saleNumber}`;
      
      // ุชูุนูู ุญูู ุงูุจุงุฑููุฏ
      document.getElementById('barcode-input').focus();
      
      // ุฅุนุงุฏุฉ ุชุนููู ุงูููู
      document.getElementById('selected-products-list').innerHTML = '';
      document.getElementById('products-count').textContent = '0';
      document.getElementById('subtotal').textContent = '0.00 ุฑูุงู';
      document.getElementById('tax').textContent = '0.00 ุฑูุงู';
      document.getElementById('total').textContent = '0.00 ุฑูุงู';
      document.getElementById('payment-method').value = 'cash';
    }

    // ูุนุงูุฌุฉ ูุณุญ ุงูุจุงุฑููุฏ
    document.getElementById('barcode-input').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        const barcode = this.value.trim();
        if (barcode) {
          // ููุง ูููู ุฅุถุงูุฉ ุทูุจ API ููุจุญุซ ุนู ุงูููุชุฌ ุจุงูุจุงุฑููุฏ
          const product = {
            id: barcode,
            name: 'ููุชุฌ ูู ุงูุจุงุฑููุฏ',
            price: 100,
            stock: 10
          };
          
          // ุชุญุฏูุซ ุญูู ุงุณู ุงูููุชุฌ
          document.getElementById('product-name').value = product.name;
          // ุชุฑููุฒ ุนูู ุญูู ุงููููุฉ
          document.getElementById('product-quantity').focus();
        }
      }
    });

    // ุฅุถุงูุฉ ูุณุชูุน ูุชุจุฏูู ุงูุชุฑููุฒ ุจูู ุญููู ุงูุจุญุซ ูุงูุจุงุฑููุฏ
    document.getElementById('product-name').addEventListener('focus', function() {
      document.getElementById('barcode-input').value = '';
    });

    document.getElementById('barcode-input').addEventListener('focus', function() {
      document.getElementById('product-name').value = '';
    });

    // ุฅุถุงูุฉ ููุชุฌ ููุจูุน
    function addProductToSale() {
      const barcode = document.getElementById('barcode-input').value.trim();
      const productName = document.getElementById('product-name').value.trim();
      const quantity = parseInt(document.getElementById('product-quantity').value);

      if (!barcode || !productName || quantity < 1) {
        alert('ูุฑุฌู ุฅุฏุฎุงู ุฌููุน ุงูุจูุงูุงุช ุงููุทููุจุฉ');
        return;
      }

      // ููุง ูููู ุฅุถุงูุฉ ุทูุจ API ููุญุตูู ุนูู ูุนูููุงุช ุงูููุชุฌ
      const product = {
        id: barcode,
        name: productName,
        price: 100, // ุณุนุฑ ุชุฌุฑูุจู
        quantity: quantity
      };

      const tbody = document.getElementById('selected-products-list');
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${product.name}</td>
        <td>${product.id}</td>
        <td>${product.price} ุฑูุงู</td>
        <td>${product.quantity}</td>
        <td>${product.price * product.quantity} ุฑูุงู</td>
        <td>
          <button class="btn-icon" onclick="removeProduct(this)">๐๏ธ</button>
        </td>
      `;
      tbody.appendChild(row);

      // ุฅุนุงุฏุฉ ุชุนููู ุงูุญููู
      document.getElementById('barcode-input').value = '';
      document.getElementById('product-name').value = '';
      document.getElementById('product-quantity').value = '1';
      document.getElementById('barcode-input').focus();

      updateBillSummary();
    }

    // ุชุญุฏูุซ ุงููููุฉ
    function updateQuantity(button, change) {
      const input = button.parentElement.querySelector('input');
      const newValue = parseInt(input.value) + change;
      if (newValue >= 1 && newValue <= parseInt(input.max)) {
        input.value = newValue;
        updateTotal(input);
      }
    }

    // ุชุญุฏูุซ ุงูุฅุฌูุงูู
    function updateTotal(input) {
      const row = input.closest('tr');
      const price = parseFloat(row.cells[2].textContent);
      const quantity = parseInt(input.value);
      const total = price * quantity;
      row.cells[4].textContent = `${total} ุฑูุงู`;
      updateBillSummary();
    }

    // ุญุฐู ููุชุฌ
    function removeProduct(button) {
      button.closest('tr').remove();
      updateBillSummary();
    }

    // ุชุญุฏูุซ ููุฎุต ุงููุงุชูุฑุฉ
    function updateBillSummary() {
      const rows = document.querySelectorAll('#selected-products-list tr');
      let subtotal = 0;
      
      rows.forEach(row => {
        const totalText = row.cells[4].textContent;
        const total = parseFloat(totalText.replace(' ุฑูุงู', ''));
        subtotal += total;
      });

      const discount = parseFloat(document.getElementById('discount').value) || 0;
      const afterDiscount = subtotal - discount;
      const tax = afterDiscount * 0.15;
      const finalTotal = afterDiscount + tax;

      document.getElementById('products-count').textContent = rows.length;
      document.getElementById('subtotal').textContent = `${subtotal.toFixed(2)} ุฑูุงู`;
      document.getElementById('tax').textContent = `${tax.toFixed(2)} ุฑูุงู`;
      document.getElementById('total').textContent = `${finalTotal.toFixed(2)} ุฑูุงู`;
    }

    // ุฅุชูุงู ุนูููุฉ ุงูุจูุน
    function completeSale() {
      const products = document.getElementById('selected-products-list').children;
      if (products.length === 0) {
        alert('ูุฑุฌู ุฅุถุงูุฉ ููุชุฌ ูุงุญุฏ ุนูู ุงูุฃูู');
        return;
      }
      
      const paymentMethod = document.getElementById('payment-method').value;
      const total = document.getElementById('total').textContent;
      
      // ููุง ูููู ุฅุถุงูุฉ ููุฏ ูุญูุธ ุนูููุฉ ุงูุจูุน ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
      
      alert('ุชู ุฅุชูุงู ุนูููุฉ ุงูุจูุน ุจูุฌุงุญ');
      closeNewSaleForm();
    }

    function closeNewSaleForm() {
      const form = document.getElementById('new-sale-form');
      const hasProducts = document.getElementById('selected-products-list').children.length > 0;
      
      if (hasProducts) {
        if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุฅูุบุงุก ุนูููุฉ ุงูุจูุนุ ุณูุชู ููุฏุงู ุฌููุน ุงูููุชุฌุงุช ุงููุถุงูุฉ.')) {
          form.style.display = 'none';
          resetSaleForm();
        }
      } else {
        form.style.display = 'none';
        resetSaleForm();
      }
    }

    function resetSaleForm() {
      // ุฅุนุงุฏุฉ ุชุนููู ุฌููุน ุงูุญููู ูุงูููู
      document.getElementById('selected-products-list').innerHTML = '';
      document.getElementById('barcode-input').value = '';
      document.getElementById('product-name').value = '';
      document.getElementById('product-quantity').value = '1';
      document.getElementById('discount').value = '0';
      document.getElementById('products-count').textContent = '0';
      document.getElementById('subtotal').textContent = '0.00 ุฑูุงู';
      document.getElementById('tax').textContent = '0.00 ุฑูุงู';
      document.getElementById('total').textContent = '0.00 ุฑูุงู';
      document.getElementById('payment-method').value = 'cash';
    }
  </script>
  <script src="../views/js/stores/index.js"> </script>  
</body>
</html>