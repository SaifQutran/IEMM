<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IEMM - ุฅุฏุงุฑุฉ ุงููุฌูุนุงุช</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="../views/css/styles.css" />
    <script src="../views/js/script.js" defer></script>
  </head>
  <body>
    <header>
      <div class="container navbar">
        <h1>IEMM</h1>
        <nav>
          <a href="admin-dashboard.html" id="dashboard-link">๐ ููุญุฉ ุงูุชุญูู</a>
          <a href="mall-management.html" id="malls-link" class="active"
            >๐ข ุฅุฏุงุฑุฉ ุงููุฌูุนุงุช</a
          >
          <a href="settings.html" id="settings-link">โ๏ธ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ</a>
        </nav>
        <button
          class="btn-dark"
          onclick="document.body.classList.toggle('dark')"
        >
          ุงููุถุน ุงููููู
        </button>
      </div>
    </header>

    <div class="main">
      <div class="section active" id="malls-section">
        <div class="section-header">
          <h2 class="section-title">๐ข ุฅุฏุงุฑุฉ ุงููุฌูุนุงุช</h2>
          <button class="btn-green" onclick="toggleForm()">
            โ ุฅุถุงูุฉ ูุฌูุน
          </button>
        </div>

        <div class="form card" id="mall-form" style="display: none">
          <h3>ุฅุถุงูุฉ ูุฌูุน ุฌุฏูุฏ</h3>
          <div class="form-grid">
            <input type="text" placeholder="ุงุณู ุงููุฌูุน" />
            <input type="text" placeholder="ุงุณู ุงููุงูู" />
            <input type="text" placeholder="ุงููููุน" />
            <input type="number" placeholder="ุนุฏุฏ ุงูุฃุฏูุงุฑ" />
          </div>
          <hr />
          <h4>ุจูุงูุงุช ุญุณุงุจ ุงููุงูู</h4>
          <div class="form-grid">
            <input type="text" placeholder="ุงุณู ุงููุณุชุฎุฏู" />
            <input type="email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" />
            <input type="password" placeholder="ูููุฉ ุงููุฑูุฑ" />
          </div>
          <button class="btn-green">ุฅุถุงูุฉ ุงููุฌูุน</button>
        </div>
        <form action="" id="mall-form" style="display: none" method="post">
          <div class="form card">
            <h3>ุฅุถุงูุฉ ูุฌูุน ุฌุฏูุฏ</h3>
            <div class="form-grid">
              <input type="text" placeholder="ุงุณู ุงููุฌูุน" name="mall_name" />
              <input type="text" placeholder="ุงููููุน" name="location" />
              <input
                type="number"
                placeholder="ุนุฏุฏ ุงูุฃุฏูุงุฑ"
                name="floors_count"
              />
              <input
                type="text"
                placeholder="ุฑุงุจุท ุงููููุน ุนูู ุฎุฑุงุฆุท ูููู"
                name="location_link"
              />
              <select name="city_id" required>
                <option value="">ุงุฎุชุฑ ุงููุฏููุฉ</option>
                <!-- Cities will be loaded dynamically -->
              </select>
            </div>
            <hr />
            <h4>ุจูุงูุงุช ุญุณุงุจ ุงููุงูู</h4>
            <div class="form-grid">
              <input type="text" placeholder="ุงุณู ุงููุณุชุฎุฏู" name="username" />
              <input type="text" placeholder="ุงุณู ุงูุซูุงุฆู" name="owner_name" />
              <input
                type="email"
                placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู"
                name="email"
              />
              <input
                type="password"
                placeholder="ูููุฉ ุงููุฑูุฑ"
                name="password"
              />
              <div class="radio-group">
                <label>ุงูุฌูุณ:</label>
                <div>
                  <input
                    type="radio"
                    id="male"
                    name="sex"
                    value="true"
                    required
                  />
                  <label for="male">ุฐูุฑ</label>
                  <input type="radio" id="female" name="sex" value="false" />
                  <label for="female">ุฃูุซู</label>
                </div>
              </div>
              <input
                type="tel"
                placeholder="00967xxxxxxxx"
                name="phone"
                pattern="^[0-9]{14}$"
                maxlength="14"
                oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                title="ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฑูู ุฌูุงู ุตุญูุญ (ูุซุงู: 00967xxxxxxxx)"
              />
              <input
                type="date"
                name="birth_date"
                max="2024-12-31"
                min="1900-01-01"
                required
                title="ุงูุฑุฌุงุก ุฅุฏุฎุงู ุชุงุฑูุฎ ุงููููุงุฏ"
              />
            </div>
            <button class="btn-green" onclick="addMall()">ุฅุถุงูุฉ ุงููุฌูุน</button>
          </div>
        </form>

        <div class="table card">
          <div
            id="loading"
            style="display: none; text-align: center; padding: 20px"
          >
            ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...
          </div>
          <div
            id="error"
            style="display: none; text-align: center; padding: 20px; color: red"
          >
            ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงูุจูุงูุงุช
          </div>
          <table>
            <thead>
              <tr>
                <th>ุงุณู ุงููุฌูุน</th>
                <th>ุงููุงูู</th>
                <th>ุงููููุน</th>
                <th>ุนุฏุฏ ุงูุทูุงุจู</th>
                <th>ุงููุฏููุฉ</th>
                <th>ุงูุฅุฌุฑุงุกุงุช</th>
              </tr>
            </thead>
            <tbody>
              <!-- ุณูุชู ุฅุถุงูุฉ ุงูุจูุงูุงุช ุฏููุงููููุงู -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ุฅุถุงูุฉ ุงููุงูุฐุฉ ุงูููุจุซูุฉ ูุนุฑุถ ุจูุงูุงุช ุงููุฌูุน -->
    <div id="mallDetailsModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3>ุจูุงูุงุช ุงููุฌูุน</h3>
        <div class="mall-details" id="mallDetailsContent">
          <!-- ุณูุชู ุฅุถุงูุฉ ุงูุจูุงูุงุช ุฏููุงููููุงู -->
        </div>
        <button class="btn-green" id="changeOwnerBtn">ุชุบููุฑ ูุงูู ุงููุฌูุน</button>

        <!-- ูููุฐุฌ ุชุบููุฑ ุงููุงูู -->
        <div id="changeOwnerForm" style="display: none; margin-top: 20px">
          <div class="form-grid">
            <input
              type="text"
              id="newOwnerName"
              placeholder="ุงุณู ุงููุงูู ุงูุฌุฏูุฏ"
            />
            <input
              type="email"
              id="newOwnerEmail"
              placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู"
            />
          </div>
          <div
            style="
              margin-top: 10px;
              display: flex;
              gap: 10px;
              justify-content: flex-start;
            "
          >
            <button class="btn-green" onclick="submitOwnerChange()">
              ุญูุธ ุงูุชุบููุฑุงุช
            </button>
            <button class="btn-dark" onclick="cancelOwnerChange()">
              ุฅูุบุงุก
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // ุจูุงูุงุช ุงุฎุชุจุงุฑูุฉ ูููุฌูุนุงุช
      const testMalls = [
        {
          id: 1,
          name: "ูุฌูุน ุงููุฎูู ููู",
          owner: "ุนุจุฏุงููู ุงูุนูุฑู",
          location: "ุทุฑูู ุงูููู ุนุจุฏุงูุนุฒูุฒ",
          floors: 3,
          city: "ุงูุฑูุงุถ",
        },
        {
          id: 2,
          name: "ูุฌูุน ุงูุฑุงุดุฏ",
          owner: "ูุญูุฏ ุงูุณุนูุฏ",
          location: "ุดุงุฑุน ุงูุฃููุฑ ูุงูู",
          floors: 4,
          city: "ุงููุฏููุฉ ุงููููุฑุฉ",
        },
        {
          id: 3,
          name: "ูุฌูุน ุงูุฃูุฏูุณ",
          owner: "ุณุนุฏ ุงููุญุทุงูู",
          location: "ุทุฑูู ุงูููู ููุฏ",
          floors: 5,
          city: "ุฌุฏุฉ",
        },
        {
          id: 4,
          name: "ูุฌูุน ุงูุธูุฑุงู",
          owner: "ููุตู ุงูุชุฑูู",
          location: "ุดุงุฑุน ุงูุฃููุฑ ูุญูุฏ",
          floors: 3,
          city: "ุงูุฏูุงู",
        },
        {
          id: 5,
          name: "ูุฌูุน ุญูุงุฉ ููู",
          owner: "ุฎุงูุฏ ุงูุดูุฑู",
          location: "ุทุฑูู ุงูููู ุฎุงูุฏ",
          floors: 2,
          city: "ุชุจูู",
        },
        {
          id: 6,
          name: "ูุฌูุน ุงููุงุญุฉ",
          owner: "ููุงู ุงูุนุชูุจู",
          location: "ุดุงุฑุน ุงูุณุชูู",
          floors: 4,
          city: "ุฃุจูุง",
        },
        {
          id: 7,
          name: "ูุฌูุน ุงููุตูู ููู",
          owner: "ุจูุฏุฑ ุงูุณููู",
          location: "ุทุฑูู ุนูุฑ ุจู ุงูุฎุทุงุจ",
          floors: 3,
          city: "ุจุฑูุฏุฉ",
        },
      ];

      // ุฏุงูุฉ ูุฅุถุงูุฉ ุงูุจูุงูุงุช ุงูุงุฎุชุจุงุฑูุฉ ุฅูู ุงูุฌุฏูู
      function populateTableWithTestData() {
        const tableBody = document.querySelector("table tbody");

        // ุชูุฑูุบ ุงูุฌุฏูู
        tableBody.innerHTML = "";

        // ุฅุฎูุงุก ุฑุณุงูุฉ ุงูุชุญููู ูุฅุธูุงุฑ ุงูุฌุฏูู
        document.getElementById("loading").style.display = "none";

        // ุฅุถุงูุฉ ุงูุจูุงูุงุช ุงูุงุฎุชุจุงุฑูุฉ
        testMalls.forEach((mall) => {
          const row = document.createElement("tr");

          // ุฅูุดุงุก ุฎูุงูุง ุงูุจูุงูุงุช
          const nameCell = document.createElement("td");
          nameCell.textContent = mall.name;

          const ownerCell = document.createElement("td");
          ownerCell.textContent = mall.owner;

          const locationCell = document.createElement("td");
          locationCell.textContent = mall.location;

          const floorsCell = document.createElement("td");
          floorsCell.textContent = mall.floors;

          const cityCell = document.createElement("td");
          cityCell.textContent = mall.city;

          // ุฅุถุงูุฉ ุงูุฎูุงูุง ุฅูู ุงูุตู
          row.appendChild(nameCell);
          row.appendChild(ownerCell);
          row.appendChild(locationCell);
          row.appendChild(floorsCell);
          row.appendChild(cityCell);

          // ุฅุถุงูุฉ ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช
          const actionsCell = document.createElement("td");

          // ุฒุฑ ุงูุนุฑุถ
          const viewBtn = document.createElement("button");
          viewBtn.className = "btn-icon";
          viewBtn.innerHTML = "๐๏ธ";
          viewBtn.title = "ุนุฑุถ ุงูุชูุงุตูู";
          viewBtn.onclick = () => showMallDetails(mall);

          // ุฒุฑ ุงูุญุฐู
          const deleteBtn = document.createElement("button");
          deleteBtn.className = "btn-icon";
          deleteBtn.innerHTML = "๐๏ธ";
          deleteBtn.title = "ุญุฐู ุงููุฌูุน";
          deleteBtn.onclick = () => {
            if (confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงููุฌูุน: ${mall.name}ุ`)) {
              alert("ุชู ุญุฐู ุงููุฌูุน ุจูุฌุงุญ");
              row.remove();
            }
          };

          actionsCell.appendChild(viewBtn);
          actionsCell.appendChild(deleteBtn);
          row.appendChild(actionsCell);

          // ุฅุถุงูุฉ ุงูุตู ุฅูู ุงูุฌุฏูู
          tableBody.appendChild(row);
        });
      }

      // ุงุณุชุฏุนุงุก ุฏุงูุฉ ุฅุถุงูุฉ ุงูุจูุงูุงุช ุงูุงุฎุชุจุงุฑูุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
      document.addEventListener("DOMContentLoaded", function () {
        // ุฅุธูุงุฑ ุฑุณุงูุฉ ุงูุชุญููู
        document.getElementById("loading").style.display = "block";

        // ูุญุงูุงุฉ ุชุฃุฎูุฑ ุงูุดุจูุฉ
        setTimeout(function () {
          populateTableWithTestData();
        }, 1000);
      });
    </script>
  </body>
</html>

<script>
  // ููุฏ ููุชุนุงูู ูุน ุงููุงูุฐุฉ ุงูููุจุซูุฉ
  const modal = document.getElementById("mallDetailsModal");
  const closeBtn = document.getElementsByClassName("close")[0];

  // ุฅุบูุงู ุงููุงูุฐุฉ ุนูุฏ ุงูููุฑ ุนูู ุฒุฑ ุงูุฅุบูุงู
  closeBtn.onclick = function () {
    modal.style.display = "none";
  };

  // ุฅุบูุงู ุงููุงูุฐุฉ ุนูุฏ ุงูููุฑ ุฎุงุฑุฌูุง
  window.onclick = function (event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  };

  // ุฏุงูุฉ ูุนุฑุถ ุจูุงูุงุช ุงููุฌูุน ูู ุงููุงูุฐุฉ ุงูููุจุซูุฉ
  function showMallDetails(mallData) {
    const detailsContent = document.getElementById("mallDetailsContent");

    // ุชูุฑูุบ ุงููุญุชูู ุงูุณุงุจู
    detailsContent.innerHTML = "";

    // ุฅุถุงูุฉ ุจูุงูุงุช ุงููุฌูุน
    detailsContent.innerHTML += `<p><strong>ุงุณู ุงููุฌูุน:</strong> ${mallData.name}</p>`;
    detailsContent.innerHTML += `<p><strong>ุงููุงูู:</strong> ${mallData.owner}</p>`;
    detailsContent.innerHTML += `<p><strong>ุงููููุน:</strong> ${mallData.location}</p>`;
    detailsContent.innerHTML += `<p><strong>ุนุฏุฏ ุงูุทูุงุจู:</strong> ${mallData.floors}</p>`;
    detailsContent.innerHTML += `<p><strong>ุงููุฏููุฉ:</strong> ${mallData.city}</p>`;

    // ุชุฎุฒูู ูุนุฑู ุงููุฌูุน ููุงุณุชุฎุฏุงู ูู ุฒุฑ ุชุบููุฑ ุงููุงูู
    document
      .getElementById("changeOwnerBtn")
      .setAttribute("data-mall-id", mallData.id);

    // ุนุฑุถ ุงููุงูุฐุฉ
    modal.style.display = "block";
  }

  // ุฏุงูุฉ ูุชุบููุฑ ูุงูู ุงููุฌูุน
  document
    .getElementById("changeOwnerBtn")
    .addEventListener("click", function () {
      const changeOwnerForm = document.getElementById("changeOwnerForm");
      changeOwnerForm.style.display =
        changeOwnerForm.style.display === "none" ? "block" : "none";
      this.style.display = "none";
    });

  // ุฏุงูุฉ ูุฅูุบุงุก ุชุบููุฑ ุงููุงูู
  function cancelOwnerChange() {
    document.getElementById("changeOwnerForm").style.display = "none";
    document.getElementById("changeOwnerBtn").style.display = "block";
    document.getElementById("newOwnerName").value = "";
    document.getElementById("newOwnerEmail").value = "";
  }

  // ุฏุงูุฉ ูุญูุธ ุชุบููุฑุงุช ุงููุงูู ุงูุฌุฏูุฏ
  function submitOwnerChange() {
    const mallId = document
      .getElementById("changeOwnerBtn")
      .getAttribute("data-mall-id");
    const newOwnerName = document.getElementById("newOwnerName").value;
    const newOwnerEmail = document.getElementById("newOwnerEmail").value;

    if (!newOwnerName || !newOwnerEmail) {
      alert("ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฌููุน ุงูุจูุงูุงุช ุงููุทููุจุฉ");
      return;
    }

    // ููุง ูููู ุฅุถุงูุฉ ููุฏ ููุชุญูู ูู ุตุญุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู ุงูุฎุงุฏู
    alert(
      `ุชู ุชุบููุฑ ูุงูู ุงููุฌูุน ุจูุฌุงุญ\nุงููุงูู ุงูุฌุฏูุฏ: ${newOwnerName}\nุงูุจุฑูุฏ ุงูุฅููุชุฑููู: ${newOwnerEmail}`
    );

    // ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ
    cancelOwnerChange();

    // ุฅุบูุงู ุงููุงูุฐุฉ ุงูููุจุซูุฉ
    document.getElementById("mallDetailsModal").style.display = "none";
  }
</script>
