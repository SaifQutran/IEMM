<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IEMM - ุฅุฏุงุฑุฉ ุงููุฌูุนุงุช</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="../views/css/styles.css" />
    <script src="../views/js/script.js" defer></script>
    <script src="../views/js/theme-manager.js" defer></script>
  </head>
  <body>
    <header>
      <div class="container navbar">
        <h1>IEMM</h1>
        <nav>
          <a href="admin-dashboard.html" id="dashboard-link">๐ ููุญุฉ ุงูุชุญูู</a>
          <a href="mall-management.html" id="malls-link" class="active"
            >๐ข ุฅุฏุงุฑุฉ ุงููุฌูุนุงุช</a
          >
          <a href="settings.html" id="settings-link">โ๏ธ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ</a>
        </nav>
        <button
          class="btn-dark"
        >
          ุงููุถุน ุงููููู
        </button>
        <!-- <button
          class="btn-dark"
          onclick="document.body.classList.toggle('dark')"
        >
          ุงููุถุน ุงููููู
        </button> -->
      </div>
    </header>

    <div class="main">
      <div class="section active" id="malls-section">
        <div class="section-header">
          <h2 class="section-title">๐ข ุฅุฏุงุฑุฉ ุงููุฌูุนุงุช</h2>
          <button class="btn-green" onclick="toggleForm()">
            โ ุฅุถุงูุฉ ูุฌูุน
          </button>
        </div>

        <form action="" id="mall-form" style="display: none" method="post">
          <div class="form card">
            <h3>ุฅุถุงูุฉ ูุฌูุน ุฌุฏูุฏ</h3>
            <div class="form-grid">
              <input type="text" placeholder="ุงุณู ุงููุฌูุน" name="mall_name" />
              <input type="text" placeholder="ุงููููุน" name="location" />
              <input
                type="number"
                placeholder="ุนุฏุฏ ุงูุฃุฏูุงุฑ"
                name="floors_count"
              />
              <input
                type="text"
                placeholder="ุฑุงุจุท ุงููููุน ุนูู ุฎุฑุงุฆุท ูููู"
                name="location_link"
              />
              <select name="city_id" required>
                <option value="">ุงุฎุชุฑ ุงููุฏููุฉ</option>
                <!-- Cities will be loaded dynamically -->
              </select>
            </div>
            <hr />
            <h4>ุจูุงูุงุช ุญุณุงุจ ุงููุงูู</h4>
            <div class="form-grid">
              <input type="text" placeholder="ุงุณู ุงููุณุชุฎุฏู" name="username" />
              <input
                type="text"
                placeholder="ุงูุงุณู ุงูุซูุงุฆู"
                name="owner_name"
              />
              <input
                type="email"
                placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู"
                name="email"
              />
              <input
                type="password"
                placeholder="ูููุฉ ุงููุฑูุฑ"
                name="password"
              />
              <div class="radio-group">
                <label>ุงูุฌูุณ:</label>
                <div>
                  <input
                    type="radio"
                    id="male"
                    name="sex"
                    value="true"
                    required
                  />
                  <label for="male">ุฐูุฑ</label>
                  <input type="radio" id="female" name="sex" value="false" />
                  <label for="female">ุฃูุซู</label>
                </div>
              </div>
              <input
                type="tel"
                placeholder="00967xxxxxxxx"
                name="phone"
                pattern="^[0-9]{14}$"
                maxlength="14"
                oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                title="ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฑูู ุฌูุงู ุตุญูุญ (ูุซุงู: 00967xxxxxxxx)"
              />
              <input
                type="date"
                name="birth_date"
                max="2024-12-31"
                min="1900-01-01"
                required
                title="ุงูุฑุฌุงุก ุฅุฏุฎุงู ุชุงุฑูุฎ ุงููููุงุฏ"
              />
            </div>
            <button class="btn-green" onclick="addMall(event)">
              ุฅุถุงูุฉ ุงููุฌูุน
            </button>
          </div>
        </form>

        <div class="table card">
          <div
            id="loading"
            style="display: none; text-align: center; padding: 20px"
          >
            ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...
          </div>
          <div
            id="error"
            style="display: none; text-align: center; padding: 20px; color: red"
          >
            ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงูุจูุงูุงุช
          </div>
          <table>
            <thead>
              <tr>
                <th>ุงุณู ุงููุฌูุน</th>
                <th>ุงููุงูู</th>
                <th>ุงููููุน</th>
                <th>ุนุฏุฏ ุงูุทูุงุจู</th>
                <th>ุงููุฏููุฉ</th>
                <th>ุงูุฅุฌุฑุงุกุงุช</th>
              </tr>
            </thead>
            <tbody>
              <!-- ุณูุชู ุฅุถุงูุฉ ุงูุจูุงูุงุช ุฏููุงููููุงู -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ุฅุถุงูุฉ ุงููุงูุฐุฉ ุงูููุจุซูุฉ ูุนุฑุถ ุจูุงูุงุช ุงููุฌูุน -->
    <div id="mallDetailsModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3>ุจูุงูุงุช ุงููุฌูุน</h3>
        <div class="mall-details" id="mallDetailsContent">
          <!-- ุณูุชู ุฅุถุงูุฉ ุงูุจูุงูุงุช ุฏููุงููููุงู -->
        </div>
        <button class="btn-green" id="changeOwnerBtn">ุชุบููุฑ ูุงูู ุงููุฌูุน</button>

        <!-- ูููุฐุฌ ุชุบููุฑ ุงููุงูู -->
        <div id="changeOwnerForm" style="display: none; margin-top: 20px">
          <h4>ุจูุงูุงุช ุงููุงูู ุงูุฌุฏูุฏ</h4>
          <div class="form-grid">
            <input
              type="text"
              placeholder="ุงุณู ุงููุณุชุฎุฏู"
              id="newUsername"
              name="newUsername"
            />
            <input
              type="text"
              placeholder="ุงูุงุณู ุงูุซูุงุฆู"
              id="newOwnerName"
              name="newOwnerName"
            />
            <input
              type="email"
              placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู"
              id="newOwnerEmail"
              name="newOwnerEmail"
            />
            <input
              type="password"
              placeholder="ูููุฉ ุงููุฑูุฑ"
              id="newPassword"
              name="newPassword"
            />
            <div class="radio-group">
              <label>ุงูุฌูุณ:</label>
              <div>
                <input
                  type="radio"
                  id="newMale"
                  name="newSex"
                  value="true"
                  required
                />
                <label for="newMale">ุฐูุฑ</label>
                <input
                  type="radio"
                  id="newFemale"
                  name="newSex"
                  value="false"
                />
                <label for="newFemale">ุฃูุซู</label>
              </div>
            </div>
            <input
              type="tel"
              placeholder="00967xxxxxxxx"
              id="newPhone"
              name="newPhone"
              pattern="^[0-9]{14}$"
              maxlength="14"
              oninput="this.value = this.value.replace(/[^0-9]/g, '')"
              title="ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฑูู ุฌูุงู ุตุญูุญ (ูุซุงู: 00967xxxxxxxx)"
            />
            <input
              type="date"
              id="newBirthDate"
              name="newBirthDate"
              max="2024-12-31"
              min="1900-01-01"
              required
              title="ุงูุฑุฌุงุก ุฅุฏุฎุงู ุชุงุฑูุฎ ุงููููุงุฏ"
            />
          </div>
          <div
            style="
              margin-top: 10px;
              display: flex;
              gap: 10px;
              justify-content: flex-start;
            "
          >
            <button class="btn-green" onclick="submitOwnerChange()">
              ุญูุธ ุงูุชุบููุฑุงุช
            </button>
            <button class="btn-dark" onclick="cancelOwnerChange()">
              ุฅูุบุงุก
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // ููุฏ ููุชุนุงูู ูุน ุงููุงูุฐุฉ ุงูููุจุซูุฉ
      const modal = document.getElementById("mallDetailsModal");
      const closeBtn = document.getElementsByClassName("close")[0];

      // ุฅุบูุงู ุงููุงูุฐุฉ ุนูุฏ ุงูููุฑ ุนูู ุฒุฑ ุงูุฅุบูุงู
      closeBtn.onclick = function () {
        modal.style.display = "none";
      };

      // ุฅุบูุงู ุงููุงูุฐุฉ ุนูุฏ ุงูููุฑ ุฎุงุฑุฌูุง
      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };

      // ุฏุงูุฉ ูุนุฑุถ ุจูุงูุงุช ุงููุฌูุน ูู ุงููุงูุฐุฉ ุงูููุจุซูุฉ
    </script>

    <script>
      function toggleNightMode() {
        document.body.classList.toggle("dark");
        document.documentElement.classList.toggle("dark");
        var expires = "";
        var days = 365;
        var date = new Date();
        date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
        expires = "; expires=" + date.toUTCString();
        document.cookie =
          "nightMode=" +
          (document.body.classList.contains("dark") ? "on" : "off") +
          expires +
          "; path=/";
        console.log("Cookie after set:", document.cookie);
      }
    </script>

    <!-- All JS scripts at the end for best performance -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="../views/js/script.js"></script>
    <script src="../views/js/admin/mall-mangement.js"></script>
  </body>
</html>
